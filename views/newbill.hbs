<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
     <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css"
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
        integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.7/dist/umd/popper.min.js"
        integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/js/bootstrap.min.js"
        integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
        crossorigin="anonymous"></script>
<style>
    #p button{
       width: 120px;
       text-align: center;
    }
    input{
        width: 150px;
        height: 25px;
        text-justify: right;
        text-align: center;
        border: 1px solid black;

    }
    table input{
        border: 1px solid white;
    } 
    #add{
        display:none;
        margin-left: 50%;
        z-index: 1;
    }
    table {
     border: 2px solid black;
     width: 100%;
    }
    th,td{
        border: 2px solid black;
        text-align: center;
    width: 100px;
    }
    #po input{
        border: 1px solid white;
        background-color: lightblue;
    }
    #gst1{
        display: none;
    }
    #gst1 input{
            border: 2px solid white;

    }
    #pl{
        height: 500px;
    }
    .cl{
        display: none;
    }
</style>
</head>
<body>
  <br>
  <br>
  {{p}}
     <div class="row">
        <div class="col-md-1" id="p">
              <button onclick="addproduct()">new product</button>
               <br>
              <button onclick="ol()">Get a GST</button>
              <br>
              <button onclick="removerow()">Delete row</button>
              <br>
              <button>new Customer</button>
              <br>
              <button >Check price</button>
              <br>
              <button onclick="submit()">generate a bill</button>
              <br>
              <button onclick="getbillpp()">print a bill</button>
              <br>
    
        </div>
        <div class="col-md-8">
            <div class="row">
                <div class="col-md-5">
                    <label for="invoice">Invoice_no:</label>
                    <input type="text" value="{{invoice}}" id="invoice" disabled>
                </div>
                 <div class="col-md-2"></div>
                 <div class="col-md-4">
                    <label for="">Date:-</label>
                    <input type="text" value="{{de}}" disabled id="date">
                 </div>
            </div>
            <br>
            <div class="row">
                <div class="col-md-4">
                    <input type="text" id="customer" onkeyup="customerr1(this.value,'customer')" placeholder="customername">
                </div>
                <div class="col-md-4">
                    
                    <input type="text" id="phonenumber"  onkeyup="customerr1(this.value,'phonenumber')" maxlength="10" minlength="10" placeholder="phone number">
                </div>
                <div class="col-md-4">
                   
                    <input type="text" name="" id="address" onfocus="address()" placeholder="Address">
                </div>
            </div>
            <br>
            <div class="row">
                <div class="col-md-4">
                    <input type="text"  onclick="" placeholder="Gstno:-" disabled>
                </div>
                <div class="col-md-4">
                    <input type="text"  onclick="" id="state" placeholder="State" >
                </div>
                <div class="col-md-4"> 
                    <input type="text"  onclick="" id="zip" placeholder="PinCode" >
                </div>
            </div>
            <br>
            
        </div>
     <div class="col-md-1">
       <div class="search" id="search">
        <p>lolo</p>
       </div>
     </div>
     </div>
     </div> 
     <textarea name="" id="add" cols="30" rows="10" onblur="remove(this.value)"></textarea>
  <div class="row">
    <div class="col-md-2">
    </div>
    <div class="col-md-8" id="pl">
        <div class="po" id="po">
            <div class="o" id="o">
                       <input type="text" name="" id="" class="sno" width="auto" placeholder="sno" disabled>
                       <input type="text"  id="pname" class="productname" placeholder="productname" disabled>
                          <input type="text" name="" id="" class="quantity" placeholder="quantity" disabled>
                           <input type="text" name="" id="" class="price" placeholder="price" disabled>
                           <input type="text" name="" id="" class="discount" placeholder="discount" disabled>
                           <select name="" id="" class="gst" disabled >
                            <option value="5">5%</option>
                            <option value="18">18%</option>
                            <option value="28">18%</option>
                        </select>
                        <input type="text" name="" id="" class="" placeholder="total" disabled>
                        <br>
            </div>
            <div class="op" id="op">
                       <input type="text" name="" id="" class="sno" width="auto" placeholder="sno">
                       <input type="text"  id="pname" class="pname" onkeyup="product(this.value)">
                          <input type="text" name="" id="quantity" class="quantity" onkeyup="k(this.value)">
                           <input type="text" name="" id="price" class="price">
                           <input type="text" name="" id="discount" class="discount">
                           <select name="" id="opop" class="gst">
                            <option value="5">5%</option>
                            <option value="18">18%</option>
                            <option value="28">28%</option>
                           </select>
                        <input type="text" name="" id="t" class="total" id="qw" onfocus="total()">
                        <br>
            </div>
        </div>
    </div>
    <div class="col-md-2" id="sea">
        <p>jeojko</p>
    </div>
  </div>
  <div class="row"  id="gst1">
    <div class="col-md-2">

    </div>
    <div class="col-md-8">
        <input type="text" name="" id="" disabled>
        <input type="text" name="" id="" diasbled>
        <input type="text" name="" id="" disabled>
        <input type="text" name="" id="" disabled>  
        <input type="text" name="" id="" value="">
        <select name="" id="" onclick="Gst()"  >
            <option value="">Gst5%</option>
        </select>
        <input type="text" name="" id="val" style="width:100px">
        <br>
        <input type="text" name="" id="" disabled>
        <input type="text" name="" id="" diasbled>
        <input type="text" name="" id="" disabled>
        <input type="text" name="" id="" disabled>  
        <input type="text" name="" id="" value="">
        <select name="" id="" onclick="Gst()" >
            <option value="">Gst18%</option>
        </select>
        <input type="text" name="" id="val1" style="width:80px">
        <br>
        <input type="text" name="" id="" disabled>
        <input type="text" name="" id="" diasbled>
        <input type="text" name="" id="" disabled>
        <input type="text" name="" id="" disabled>  
        <input type="text" name="" id="val" value="">
        <select name="" id="" onclick="Gst()">
            <option value="">Gst28%</option>
        </select>
        <input type="text" id="val2"  style="width:80px" placeholder="pp">
        <br>
        <input type="text" name="" id="" disabled>
        <input type="text" name="" id="" diasbled>
        <input type="text" name="" id="" disabled>
        <input type="text" name="" id="" disabled>  
        <input type="text" name="" id="val" value="">
        <select name="" id="">
            <option value="">Total</option>
        </select>
        <input type="text" id="totalamount" onclick="totalamount()" style="width:80px" placeholder="pp">
    </div>
  </div>
</body>
<script>
    var ei=0;
    var te=0;
    var f=0;
    function Gst(){
        console.log('pp');
          const t=document.getElementsByClassName('gst');
          for(var i=0;i<t.length;i++){
             if(t[i].value==18){
 const p=document.getElementsByClassName('quantity')[i].value;
    const p1=document.getElementsByClassName('price')[i].value;
    const p2=document.getElementsByClassName('discount')[i].value;
    const p3=document.getElementsByClassName('gst')[i].value;

               var sump=(p*(p1-p2))-((p*(p1-p2))*(100/(100+parseInt(p3))));
                sump=Math.round(sump);
                 ei+=sump;
             }
             else if(t[i].value==28){
                 const p=document.getElementsByClassName('quantity')[i].value;
                 const p1=document.getElementsByClassName('price')[i].value;
                 const p2=document.getElementsByClassName('discount')[i].value;
                 const p3=document.getElementsByClassName('gst')[i].value;

               var sump=(p*(p1-p2))-((p*(p1-p2))*(100/(100+parseInt(p3))));
                sump=Math.round(sump);
                te=te+sump;
             }
             else{
                 const p=document.getElementsByClassName('quantity')[i].value;
    const p1=document.getElementsByClassName('price')[i].value;
    const p2=document.getElementsByClassName('discount')[i].value;
    const p3=document.getElementsByClassName('gst')[i].value;

               var sump=(p*(p1-p2))-((p*(p1-p2))*(100/(100+parseInt(p3))));
                sump=Math.round(sump);
                f+=sump;
             }
          }
          document.getElementById('val').value=f;
          document.getElementById('val1').value=ei;
          document.getElementById('val2').value=te;
    }
   
    function address(){
        document.getElementById('add').style.display='block';
    }
    function remove(e){
        console.log(e)
        document.getElementById('address').value=e;
        document.getElementById('add').style.display='none';
    }
    function customerr1(e,f){
        console.log('eneterd')
        console.log(f);
     fetch(`customers?e=${e}&f=${f}`).then(res=>res.json()).then(data=>{
        let r=data.ar;
        const d=document.getElementById('search');
        d.innerHTML='';
        if(r.length==0){
             const p=document.createElement('p');
             const n=document.createTextNode('Sorry name was not available')
             p.appendChild(n);
             d.appendChild(p);
        }
        else{
            for(var i=0;i<r.length;i++){
             const p=document.createElement('p');
             const n=document.createTextNode(r[i]);
             p.appendChild(n);
             d.appendChild(p);
            }
        }
     })
    }
     function removerow(){
        const y1= document.getElementsByClassName("op");
        const u=y1[y1.length-1];
        if(y1.length!=1){
        u.remove()
        }
     }
    function addproduct(){
        let table = document.getElementById("op");
        const div=document.createElement("div");
        div.style.backgroundColor='lightblue';
        div.setAttribute("class","op");
        div.set
        div.insertAdjacentHTML('beforeend',table.innerHTML);
        document.getElementById('po').appendChild(div);
    }

    function ol(){
        document.getElementById('gst1').style.display='block';
    }
    function product(e){
        const s=document.getElementById('sea');
        console.log('s'+e)
    fetch('bill1',{
        method:'POST',
        headers:{ 'Content-Type': 'application/json'},
        body:JSON.stringify({payload:e})
    }).then(res=> res.json()).then(data=>{
        let payload=data.payload;
        s.innerHTML='';
        console.log(payload)
        if(payload.length<1){
            s.innerHTML='<p>Sorry. not found.</p>'
            return ; 
        }

        payload.forEach(element => {
            s.innerHTML+='<hr>';
            s.innerHTML+=`<p onclick="sd(this.innerHTML)">`+element+`</p>`;
        });

        return ;
    })
    }
    function sd(e){
        const r=document.getElementsByClassName('pname');
        const rt=r[r.length-1];
        rt.value=e;
    }
    function total(){
    var i=0;
    const divs = document.querySelectorAll('.total');

divs.forEach(div => {
  div.addEventListener('click', function() {
    const p=document.getElementsByClassName('quantity')[i].value;
    const p1=document.getElementsByClassName('price')[i].value;
    const p2=document.getElementsByClassName('discount')[i].value;
    const p3=document.getElementsByClassName('gst')[i].value;

               var sump=(p*(p1-p2))-((p*(p1-p2))*(100/(100+parseInt(p3))));
                sump=Math.round(sump);
    console.log(sump)
    document.getElementsByClassName('total')[i-1].value=p*(p1-p2)-sump;
  });
  i+=1;
});
    }
    function totalamount(){
        const ok=document.getElementsByClassName('total');
        let t=0;
        console.log('[[]]'+ok.length);
        for(var i=0;i<ok.length;i++){
        t+=parseInt(ok[i].value);
        }
        console.log(t);
        t+=f;
        t+=te;
        t+=ei;
        document.getElementById('totalamount').value=t;
    }


    function submit(){
        const in1=document.getElementById('invoice').value;
        const dat1=document.getElementById('date').value;
        const r=document.getElementById('customer').value;
        const r1=document.getElementById('phonenumber').value;
        const r2=document.getElementById('address').value;
        const r3=document.getElementById('state').value;
        const r4=document.getElementById('zip').value;
        const y=document.getElementsByClassName('pname');
        const y1=document.getElementsByClassName('quantity');
        const y2=document.getElementById('totalamount').value;
        console.log(y2);
        const pname=[];
        const qu=[];
        console.log(in1+' '+dat1);
         for(var i=0;i<y.length;i++){
            console.log(y[i].value+'---'+y1[i+1].value);
            pname.push(y[i].value);
            qu.push(y1[i+1].value);
        }
         const u=pname.join(',');
         const u1=qu.join(',');
         console.log(u+'okokokook'+u1);
              
          fetch(`cust?custname=${r}&phone=${r1}&pro=${u}&quantity=${u1}&total=${y2}&d=${dat1}&i=${in1}`).then(res=>
          res.json()) 
    }
    function getbillpp(){
       console.log('pppp');
        const r=document.getElementById('customer').value;
        const y=document.getElementById('address').value;
        const p=document.getElementById('phonenumber').value;
        const in1=document.getElementById('invoice').value;
        const d=document.getElementById('date').value;
        const pin=document.getElementById('zip').value;
        const prod=document.getElementsByClassName('pname');
        let sno='';
        let arr='';
        var i=1;
       for(var j=0;j<prod.length;j++){
           sno+=(i+',');
           arr+=(prod[j].value+',')
           i+=1;
           arr+=prod[j]+',';
        }
        //console.log(pin);
        console.log(sno)
        console.log(arr);
        window.location.href=`http://localhost:1000/print?r=${r}&y=${y}&p=${p}&in1=${in1}&d=${d}&zip=${pin}&sno:${sno}&arr=${arr}`;
    }
    
      function k(k){
        const p=document.getElementsByClassName('pname');
        const r=document.getElementsByClassName('pname')[p.length-1].value;
        fetch('quan',{
        method:'POST',
        headers:{ 'Content-Type': 'application/json'},
        body:JSON.stringify({pname:r,quanti:k})
        }).then(res=>res.json()).then(data=>{
            if(data.arr.length<1)
              window.alert('product name is wrong');
            if(!data.bool)
              window.alert('quantity is low in stock')
        })
    }
</script>
</html>